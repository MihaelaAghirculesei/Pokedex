let pokemonDetails=[];const BASE_URL="https://pokeapi.co/api/v2/";let offset=0;const limit=30,typeColor={bug:"#26de81",dragon:"#ffeaa7",electric:"#fed330",fairy:"#FF0069",fighting:"#30336b",fire:"#f0932b",flying:"#81ecec",grass:"#00b894",ground:"#EFB549",ghost:"#a55eea",ice:"#74b9ff",normal:"#95afc0",poison:"#6c5ce7",psychic:"#a29bfe",rock:"#2d3436",water:"#0190FF"},loadingIndicator=document.getElementById("loading"),loadMoreButton=document.getElementById("load-more"),pokedexContainer=document.getElementById("pokedex-container");async function init(){showLoading(),await fetchPokemonData(),initSearch(),hideLoading()}async function fetchPokemonData(){const e={};try{await manageFetchLoading();const t=await fetchAndProcessPokemonData(e);pokemonDetails.push(...t),offset+=30,renderPokemon()}catch(e){handleFetchError(e)}finally{resetFetchLoading()}}async function fetchAndProcessPokemonData(e){const t=await fetchPokemons();return await fetchPokemonDetails(t.results,e)}async function manageFetchLoading(){showLoading(),loadMoreButton.disabled=!0}async function fetchPokemons(){const e=await fetch(`${BASE_URL}pokemon?offset=${offset}&limit=30`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return await e.json()}async function fetchPokemonDetails(e,t){return await Promise.all(e.map(async e=>{if(t[e.name])return t[e.name];const n=await fetchPokemonDetail(e.url);return t[e.name]=n,n}))}async function fetchPokemonDetail(e){return(await fetch(e)).json()}function handleFetchError(e){showError("Failed to load Pokémon data. Please try again later.")}function resetFetchLoading(){hideLoading(),loadMoreButton.disabled=!1}let searchTimeoutId=null;function initSearch(){document.getElementById("search-input").addEventListener("input",handleSearchInput)}function handleSearchInput(e){const t=e.target.value.toLowerCase();if(t.length<3)return renderPokemon(pokemonDetails.slice(0,30));clearTimeout(searchTimeoutId),searchTimeoutId=setTimeout(()=>handleSearch(t),300)}function handleSearch(e){const t=pokemonDetails.filter(t=>t.name.toLowerCase().startsWith(e)).slice(0,10);renderPokemon(t.length?t:displayError(`Keine Pokémon gefunden für "${e}".`))}function renderPokemon(e=pokemonDetails){removeCardHoverEffects();const t=document.createDocumentFragment();e.forEach(e=>t.appendChild(createPokemonCard(e))),pokedexContainer.replaceChildren(t),addCardHoverEffects()}function createPokemonCard(e){const t=document.createElement("div");return t.className="pokemon-card",t.dataset.name=e.name,t.style.backgroundColor=typeColor[e.types[0].type.name]||"#ffffff",t.innerHTML=createPokemonCardTemplate(e),t}function displayError(e){pokedexContainer.innerHTML=errorMessageTemplate(e)}const TYPE_ICONS={water:"imgs/icons/water.png",grass:"imgs/icons/grass.png",fire:"imgs/icons/fire.png",normal:"imgs/icons/normal.png",bug:"imgs/icons/bug.png",poison:"imgs/icons/poison.png",electric:"imgs/icons/electric.png",ground:"imgs/icons/ground.png",flying:"imgs/icons/flying.png",psychic:"imgs/icons/psychic.png",fairy:"imgs/icons/fairy.png",fighting:"imgs/icons/fighting.png",rock:"imgs/icons/rock.png",steel:"imgs/icons/steel.png",ice:"imgs/icons/ice.png",ghost:"imgs/icons/ghost.png",dark:"imgs/icons/dark.png",dragon:"imgs/icons/dragon.png"},getTypeIconSrc=e=>TYPE_ICONS[e]||"imgs/icons/default.png";function removeCardHoverEffects(){document.querySelectorAll(".pokemon-card").forEach(e=>{e.removeEventListener("mousemove",handleHover),e.removeEventListener("mouseleave",resetCard)})}function addCardHoverEffects(){document.querySelectorAll(".pokemon-card").forEach(e=>{e.addEventListener("mousemove",handleHover),e.addEventListener("mouseleave",resetCard)})}function handleHover(e){const{clientX:t,clientY:n}=e,{left:o,top:a,width:i,height:r}=this.getBoundingClientRect(),s=(t-o)/i,c=(n-a)/r;this.style.setProperty("--x",100*s+"%"),this.style.setProperty("--y",100*c+"%")}function resetCard(){this.style.setProperty("--x","50%"),this.style.setProperty("--y","50%")}function initLogoAnimation(){const e=document.querySelector(".header .headline-icon");e&&e.classList.add("animate-logo");const t=document.querySelector(".footer .headline-icon");if(t){createLogoObserver().observe(t)}}function createLogoObserver(){return new IntersectionObserver(handleLogoIntersection,{threshold:.5,rootMargin:"0px"})}function handleLogoIntersection(e){e.forEach(e=>{e.isIntersecting&&animateLogoEntry(e)})}function animateLogoEntry(e){e.target.classList.remove("animate-logo"),setTimeout(()=>e.target.classList.add("animate-logo"),10)}function createDetailsHTML(e){const t=(e.height/10).toFixed(1),n=(e.weight/10).toFixed(1),o=e.abilities.map(e=>e.ability.name).join(", ");return detailTemplate(e,t,n,o)}document.addEventListener("DOMContentLoaded",()=>{init(),setTimeout(()=>{initLogoAnimation()},1e3)});const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);function openTab(e,t){hideAllTabs(),showActiveTab(t),e.currentTarget.classList.add("active"),handleTabSpecificActions(t);const n=document.querySelector(".details-card");n&&setTimeout(()=>{addGlitterEffect(n)},100)}function handleTabSpecificActions(e){const t=document.querySelector(".details-card");t&&("Moves"===e?(t.classList.add("moves-active"),loadMovesIfNeeded()):t.classList.remove("moves-active"))}function loadMovesIfNeeded(){const e=document.querySelector(".moves-container");if(e&&"Loading moves..."===e.innerHTML.trim()){loadPokemonMoves(e.id.replace("moves-",""))}}function hideAllTabs(){document.querySelectorAll(".tab-content").forEach(e=>{e.style.display="none"}),document.querySelectorAll(".tab-button").forEach(e=>{e.classList.remove("active")})}const showActiveTab=e=>document.getElementById(e).style.display="block",showLoading=()=>loadingIndicator.removeAttribute("hidden"),hideLoading=()=>loadingIndicator.setAttribute("hidden","true");function showPokemonDetails(e){const t=createOverlay(),n=document.createElement("div");n.className="details-card",n.style.backgroundColor=typeColor[e.types[0].type.name]||"#ffffff",n.innerHTML=createDetailsHTML(e),appendNavigationButtons(n,e),addGlitterEffect(n),t.appendChild(n),document.body.appendChild(t),document.body.classList.add("no-scroll"),t.addEventListener("click",e=>e.target===t&&closeOverlay(t))}function createOverlay(){const e=document.createElement("div");return e.className="overlay",e}function appendNavigationButtons(e,t){const n=e.querySelector(".pokemon-image-section");if(!n)return;const o=createButton("prev",t),a=createButton("next",t);o.classList.add("arrow-left"),a.classList.add("arrow-right"),n.appendChild(o),n.appendChild(a)}function createButton(e,t){const n=document.createElement("button");return n.textContent="prev"===e?"<":">",n.className=`arrow-button ${e}`,n.addEventListener("click",n=>{n.stopPropagation(),"prev"===e?showPreviousPokemon(t):showNextPokemon(t)}),n}function showPreviousPokemon(e){const t=(pokemonDetails.indexOf(e)-1+pokemonDetails.length)%pokemonDetails.length;updateDetailsCard(pokemonDetails[t])}function showNextPokemon(e){const t=(pokemonDetails.indexOf(e)+1)%pokemonDetails.length;updateDetailsCard(pokemonDetails[t])}function updateDetailsCard(e){const t=document.querySelector(".details-card");t&&(t.style.opacity=0,setTimeout(()=>{t.style.backgroundColor=typeColor[e.types[0].type.name]||"#ffffff",t.innerHTML=createDetailsHTML(e),appendNavigationButtons(t,e),addGlitterEffect(t),t.style.opacity=1},300))}function createGlitterElements(){const e=document.createElement("div"),t=document.createElement("div");return e.className="glitter-effect glitter-1",t.className="glitter-effect glitter-2",[e,t]}function addGlitterEffect(e){e.querySelectorAll(".glitter-effect").forEach(e=>e.remove());const[t,n]=createGlitterElements();e.appendChild(t),e.appendChild(n),attachGlitterListeners(e,t,n)}function attachGlitterListeners(e,t,n){e.addEventListener("mouseenter",()=>{t.classList.add("active"),n.classList.add("active")}),e.addEventListener("mouseleave",()=>{t.classList.remove("active"),n.classList.remove("active")})}function closeOverlay(e){document.body.removeChild(e),document.body.classList.remove("no-scroll")}function addHyphenation(e){return e.split(" ").map(e=>hyphenateWord(e)).join(" ")}function hyphenateWord(e){if(e.length<=6)return e;let t=e;return t=t.replace(/([bcdfghjklmnpqrstvwxyz])\1/gi,"$1­$1"),t=t.replace(/([aeiou])([bcdfghjklmnpqrstvwxyz])([aeiou])/gi,"$1­$2$3"),t=t.replace(/([aeiou])([bcdfghjklmnpqrstvwxyz])([bcdfghjklmnpqrstvwxyz])([aeiou])/gi,"$1$2­$3$4"),t=t.replace(/(un|re|pre|dis|mis|over|under|out)([bcdfghjklmnpqrstvwxyz])/gi,"$1­$2"),t=t.replace(/([aeiou])ing$/gi,"$1­ing"),t=t.replace(/([aeiou])ed$/gi,"$1­ed"),t}async function loadPokemonMoves(e){const t=document.getElementById(`moves-${e}`);if(t)try{const n=await fetch(`https://pokeapi.co/api/v2/pokemon/${e}`),o=(await n.json()).moves.slice(0,20).map(e=>({name:capitalizeFirstLetter(e.move.name.replace("-"," ")),learnMethod:capitalizeFirstLetter(e.version_group_details[0]?.move_learn_method.name||"unknown")}));t.innerHTML=createMovesHTMLTemplate(o)}catch(e){t.innerHTML=movesErrorTemplate()}}loadMoreButton.addEventListener("click",fetchPokemonData),pokedexContainer.addEventListener("click",e=>{if(e.target.closest(".pokemon-card")){const t=e.target.closest(".pokemon-card").dataset.name;showPokemonDetails(pokemonDetails.find(e=>e.name===t))}});